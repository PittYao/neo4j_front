<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="neo4jd3.css" rel="stylesheet"></link>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="neo4jd3.js"></script>
    <style>
        body {
            margin: 0;
            width: 100vw;
            height: 100vh;
        }
        #neo4j-d3 {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div 
        id="neo4j-d3" 
    >
    </div>
    
    <script>

        const neo4jData = {
            "results": [
                {
                    "columns": ["user", "entity"],
                    "data": [
                        {
                            "graph": {}
                        }
                    ]
                }
            ],
            "errors": []
        }
        
        function getData() {
            $.get("http://127.0.0.1:8080/user/graph", function(result){
                console.log(result)


                neo4jData.results[0].data[0].graph = result
                console.log(neo4jData.results[0].data[0].graph)

                
                 const neo4jd3 = new Neo4jd3('#neo4j-d3', {
                    showNodePlate: true,
                    neo4jData,
                    highlight: [],
                    highlightRelationShip: [],
                    iconMap: {
                        'rich-text': 'e65f',
                    },
                    onMenuNodeClick({ name, status, metaData }) {
                        // 点击节点 获取下层关系
                        console.log( name, status, metaData )

                        if (name === 'AttrLink') {
                            $.get("http://127.0.0.1:8080/user/graph/relationship?id="+metaData.id, function(result){
                                console.log(result)
                                let data =  neo4jData.results[0].data[0].graph
                                // 添加nodes 和 relationships 
                                data.nodes.push(...result.nodes)
                                data.relationships.push(...result.relationships)

                                neo4jd3.loadNeo4jData()

                            })
                        }
                        
                    },
                    onGetLegend(data) {
                        // 显示节点属性
                        console.log(data)
                    },
                    onNodeDoubleClick(e, d, d3) {
                        console.log(e, d, d3)
                    },
                    onRelationshipClick(e, d) {
                        // 显示关系属性
                        console.log(d)  
                    },
                    onNodeMouseEnter(e, d, d3) {
                        // 显示节点信息
                         console.log('MouseEnter', d)
                    },
            
                });

                
            });
        }

        getData()

        // const neo4jData = {
        //     "results": [
        //         {
        //             "columns": ["user", "entity"],
        //             "data": [
        //                 {
        //                     "graph": {
        //                         "nodes": [
        //                             {
        //                                 "id": "1",
        //                                 "labels": ["Project"],
        //                                 "properties": {
        //                                     "name": "neo4j",
        //                                     "title": "neo4jd3.js",
        //                                     "description": "Neo4j graph visualization using D3.js.",
        //                                     "url": "https://eisman.github.io/neo4jd3"
        //                                 }
        //                             },
        //                             {
        //                                 "id": "2",
        //                                 "labels": ["website"],
        //                                 "properties": {
        //                                     "name": "github"
        //                                 }
        //                             },
        //                             {
        //                                 "id": "3",
        //                                 "labels": ["website"],
        //                                 "properties": {
        //                                     "name": "Google",
        //                                 }
        //                             },
        //                             {
        //                                 "id": "4",
        //                                 "labels": ["website"],
        //                                 "properties": {
        //                                     "name": "fb",
        //                                 }
        //                             },
        //                             {
        //                                 "id": "5",
        //                                 "labels": ["website"],
        //                                 "properties": {
        //                                     "name": "ali",
        //                                 }
        //                             },
        //                             {
        //                                 "id": "6",
        //                                 "labels": ["website"],
        //                                 "properties": {
        //                                     "name": "jd",
        //                                 }
        //                             },
        //                             {
        //                                 "id": "7",
        //                                 "labels": ["users"],
        //                                 "properties": {
        //                                     "name": "刘强东",
        //                                 }
        //                             },
        //                             {
        //                                 "id": "8",
        //                                 "labels": ["users"],
        //                                 "properties": {
        //                                     "name": "马云",
        //                                 }
        //                             },
        //                             {
        //                                 "id": "9",
        //                                 "labels": ["users"],
        //                                 "properties": {
        //                                     "name": "张勇 逍遥子",
        //                                 }
        //                             },
        //                         ],
        //                         "relationships": [
        //                             {
        //                                 "id": "1",
        //                                 "type": "DEVELOPES",
        //                                 "startNode": "1",
        //                                 "endNode": "2",
        //                                 "properties": {}
        //                             },
        //                             {
        //                                 "id": "2",
        //                                 "type": "DEVELOPES",
        //                                 "startNode": "1",
        //                                 "endNode": "3",
        //                                 "properties": {}
        //                             },
        //                             {
        //                                 "id": "3",
        //                                 "type": "DEVELOPES",
        //                                 "startNode": "1",
        //                                 "endNode": "4",
        //                                 "properties": {}
        //                             },
        //                             {
        //                                 "id": "4",
        //                                 "type": "DEVELOPES",
        //                                 "startNode": "1",
        //                                 "endNode": "5",
        //                                 "properties": {}
        //                             },
        //                             {
        //                                 "id": "5",
        //                                 "type": "DEVELOPES",
        //                                 "startNode": "1",
        //                                 "endNode": "6",
        //                                 "properties": {}
        //                             },
        //                             {
        //                                 "id": "6",
        //                                 "type": "possess",
        //                                 "startNode": "7",
        //                                 "endNode": "6",
        //                                 "properties": {}
        //                             },
        //                             {
        //                                 "id": "7",
        //                                 "type": "possess",
        //                                 "startNode": "8",
        //                                 "endNode": "5",
        //                                 "properties": {}
        //                             },
        //                             {
        //                                 "id": "8",
        //                                 "type": "possess",
        //                                 "startNode": "9",
        //                                 "endNode": "5",
        //                                 "properties": {}
        //                             },
        //                             {
        //                                 "id": "9",
        //                                 "type": "上级",
        //                                 "startNode": "8",
        //                                 "endNode": "9",
        //                                 "properties": {
        //                                      "name": "马云",
        //                                 }
        //                             },
        //                             {
        //                                 "id": "10",
        //                                 "type": "上级",
        //                                 "startNode": "9",
        //                                 "endNode": "8",
        //                                 "properties": {}
        //                             },
        //                             {
        //                                 "id": "11",
        //                                 "type": "tools",
        //                                 "startNode": "1",
        //                                 "endNode": "1",
        //                                 "properties": {}
        //                             },
        //                         ]
        //                     }
        //                 }
        //             ]
        //         }
        //     ],
        //     "errors": []
        // }
       
        // const neo4jd3 = new Neo4jd3('#neo4j-d3', {
        //     showNodePlate: true,
        //     neo4jData,
        //     highlight: [],
        //     highlightRelationShip: [],
        //     iconMap: {
        //         'rich-text': 'e65f',
        //     },
        //     onMenuNodeClick({ name, status, metaData }) {
        //         // 点击节点
        //        console.log( name, status, metaData )
        //     },
        //     onGetLegend(data) {
        //         // 显示节点属性
        //         console.log(data)
        //     },
        //     onNodeDoubleClick(e, d, d3) {
        //         console.log(e, d, d3)
        //     },
        //     onRelationshipClick(e, d) {
        //         // 显示关系属性
        //         console.log(d)  
        //     },
    
        // });
    </script>
</body>
</html>